<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaTresor - Header Professionnel</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <!-- TOP BANNER -->
    <div class="at-header-top-banner">
        <div class="at-header-container">
            <div class="at-header-banner-content">
                <div class="at-header-contact-info">
                    <div class="at-header-contact-item">
                        <i class="material-icons">phone</i>
                        <span>+216 52 336 412</span>
                    </div>
                    <div class="at-header-contact-item">
                        <i class="material-icons">email</i>
<a [href]="'mailto:' + email" style="color:white;">{{email}}</a>                    </div>
                </div>
                <div class="at-header-professional-links">
                    <a href="#" class="at-header-professional-link">
                        <i class="material-icons">business</i>
                        <span class="at-header-professional-text">Entreprise</span>
                    </a>
                    <a href="#" class="at-header-professional-link">
                        <i class="material-icons">local_shipping</i>
                        <span class="at-header-professional-text">Livraison</span>
                    </a>
                    <a href="#" class="at-header-professional-link">
                        <i class="material-icons">security</i>
                        <span class="at-header-professional-text">Sécurisé</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="at-header-main">
        <div class="at-header-container">
            <div class="at-header-content">
                <div class="at-header-logo">
                    <a href="/" class="at-header-logo-link">
                        <img src="assets/logo.png" alt="Logo AquaTresor" class="at-header-logo-image">
                        <h1 class="at-header-logo-text">AquaTresor</h1>
                    </a>
                </div>

                <div class="at-header-menu-toggle" (click)="toggleMenu()">
                    <i class="material-icons">menu</i>
                </div>

                <nav class="at-header-navigation" [class.at-header-active]="isMenuOpen">
                    <ul class="at-header-navigation-list">
                        <li class="at-header-navigation-item">
                            <a href="/homepage" class="at-header-navigation-link" [class.active]="router.url === '/homepage'">Accueil</a>
                        </li>
                        <li class="at-header-navigation-item">
                            <a href="/shop" class="at-header-navigation-link" [class.active]="router.url === '/shop'">Boutique</a>
                        </li>
                        <li class="at-header-navigation-item">
                            <a href="/cart" class="at-header-navigation-link" [class.active]="router.url === '/cart'">Panier</a>
                        </li>
                    </ul>
                </nav>

                <div class="at-header-user-actions">
                 

                    <!-- Chat Support -->
                    <div class="at-header-action-item">
                        <button class="at-header-action-btn at-header-chat-btn" title="Chat Support" (click)="openChat()">
                            <i class="material-icons">chat</i>
                        </button>
                    </div>

                    <!-- Favoris -->
                    <div class="at-header-action-item">
                        <a href="/favorites" class="at-header-action-btn at-header-favorites-btn" title="Favoris">
                            <i class="material-icons">favorite</i>
                            <span class="at-header-action-count" *ngIf="favoritesCount > 0">{{ favoritesCount }}</span>
                        </a>
                    </div>

            <!-- Panier -->
<div class="at-header-action-item">
  <button class="at-header-action-btn at-header-cart-btn" title="Panier" (click)="toggleCart($event)">
    <i class="material-icons">shopping_cart</i>
    <span class="at-header-action-count" *ngIf="uniqueBasinCount > 0">{{ uniqueBasinCount }}</span>
  </button>
</div>

<!-- Profile Dropdown with Image -->
<div class="profile-dropdown-container">
    <button class="profile-btn" id="profileButton" aria-expanded="false" aria-controls="profileDropdown">
        <img [src]="client?.profileImage ? getProfileImageUrl(client!.profileImage) : 'assets/images/default-image-profile.webp'" 
             [alt]="client?.fullName || 'Profile'" 
             class="profile-image">
        <span class="profile-text">{{client?.fullName || ''}}</span>
        <i class="material-icons dropdown-arrow">expand_more</i>
    </button>
    <ul class="dropdown-menu" id="profileDropdown" aria-labelledby="profileButton">
        <li class="dropdown-item">
            <a href="/profile/edit" class="dropdown-link">
                <i class="material-icons">edit</i>
                <span>Modifier profil</span>
            </a>
        </li>
        <li class="dropdown-item">
            <a href="/orders" class="dropdown-link">
                <i class="material-icons">shopping_bag</i>
                <span>Mes commandes</span>
            </a>
        </li>
        <li class="dropdown-item">
            <button class="dropdown-link" (click)="logout()">
                <i class="material-icons">exit_to_app</i>
                <span>Déconnexion</span>
            </button>
        </li>
    </ul>
</div>
                    <!-- Boutons de connexion -->
                    <ng-template #authButtons>
                        <div class="at-header-auth-buttons">
                            <a routerLink="/login" class="at-header-login-btn">Connexion</a>
                            <a routerLink="/register" class="at-header-register-btn">S'inscrire</a>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </header>

    <!-- Panier latéral -->
    <div class="at-header-cart-sidebar" [class.at-header-active]="isCartOpen">
        <div class="at-header-cart-header">
            <h2><i class="material-icons">shopping_cart</i> Votre Panier</h2>
            <button class="at-header-close-btn" (click)="closeCart()" aria-label="Fermer le panier">
                <i class="material-icons">close</i>
            </button>
        </div>

        <div class="at-header-cart-content" *ngIf="cartItems.length > 0; else emptyCart">
            <div class="at-header-cart-items">
                <div class="at-header-cart-item" *ngFor="let item of cartItems">
                    <div class="at-header-item-header">
                        <h3>{{ getItemFullName(item) }}</h3>
                        <div class="at-header-badges">
                            <span class="at-header-badge" [ngClass]="{
                                'at-header-badge-stock': getItemStatus(item) === 'DISPONIBLE',
                                'at-header-badge-custom': item.isCustomized,
                                'at-header-badge-order': !item.isCustomized && getItemStatus(item) === 'SUR_COMMANDE',
                                'at-header-badge-out-of-stock': getItemStatus(item) === 'RUPTURE_STOCK'
                            }">
                                {{ getStatusDisplay(item) }}
                                <span *ngIf="(item.isCustomized || getItemStatus(item) === 'SUR_COMMANDE') ">
                                      </span>
                            </span>
                            <span class="at-header-badge at-header-badge-promo" *ngIf="item.promotionActive && item.tauxReduction">
                                -{{ item.tauxReduction * 100 | number:'1.0-0' }}%
                            </span>
                        </div>
                    </div>

                    <div class="at-header-item-content">
                        <div class="at-header-item-image">
                            <img [src]="getItemImage(item)" [alt]="item.nomBassin || item.bassin?.nomBassin" (error)="handleImageError($event, item)">
                        </div>
                        <div class="at-header-item-details">
                            <div *ngIf="item.isCustomized" class="at-header-custom-details">
                                <div class="at-header-detail-row" *ngIf="item.customization?.materiauSelectionne">
                                    <span class="at-header-detail-label">Matériau:</span>
                                    <span>{{ item.customization!.materiauSelectionne }}</span>
                                    <span class="at-header-price-addition" *ngIf="item.customization!.prixMateriau">
                                        +{{ item.customization!.prixMateriau | number:'1.2-2' }} TND
                                    </span>
                                </div>
                                <div class="at-header-detail-row" *ngIf="item.customization?.dimensionSelectionnee">
                                    <span class="at-header-detail-label">Dimensions:</span>
                                    <span>{{ item.customization!.dimensionSelectionnee }}</span>
                                    <span class="at-header-price-addition" *ngIf="item.customization!.prixDimension">
                                        +{{ item.customization!.prixDimension | number:'1.2-2' }} TND
                                    </span>
                                </div>
                                <div class="at-header-detail-row" *ngIf="item.customization?.couleurSelectionnee">
                                    <span class="at-header-detail-label">Couleur:</span>
                                    <span>{{ item.customization!.couleurSelectionnee }}</span>
                                    <span class="at-header-color-preview" [style.background-color]="getColorPreview(item.customization!.couleurSelectionnee)"></span>
                                </div>
                                <div class="at-header-detail-row" *ngIf="item.accessoires?.length">
                                    <span class="at-header-detail-label">Accessoires:</span>
                                    <span>{{ item.accessoires!.length }} accessoire(s)</span>
                                    <span class="at-header-price-addition">+{{ getTotalAccessoriesPrice(item) | number:'1.2-2' }} TND</span>
                                </div>
                                <div *ngIf="item.accessoires?.length" class="at-header-accessories-list">
                                    <div *ngFor="let acc of item.accessoires" class="at-header-accessory-item">
                                        <span>{{ acc.nomAccessoire }}</span>
                                        <span>{{ acc.prixAccessoire | number:'1.2-2' }} TND</span>
                                    </div>
                                </div>
                                <div class="at-header-detail-row at-header-fabrication-time">
                                    <span class="at-header-detail-label">Délai de fabrication:</span>
                                    <span>{{ item.customization?.dureeFabrication ? item.customization!.dureeFabrication  : 'Non spécifié' }}</span>
                                </div>
                            </div>
                            <div *ngIf="!item.isCustomized" class="at-header-standard-details">
                                <div class="at-header-detail-row" *ngIf="item.bassin?.dimensions">
                                    <span class="at-header-detail-label">Dimensions:</span>
                                    <span>{{ item.bassin!.dimensions }}</span>
                                </div>
                                <div class="at-header-detail-row" *ngIf="item.bassin?.materiau">
                                    <span class="at-header-detail-label">Matériau:</span>
                                    <span>{{ item.bassin!.materiau }}</span>
                                </div>
                                <div class="at-header-detail-row" *ngIf="item.bassin?.couleur">
                                    <span class="at-header-detail-label">Couleur:</span>
                                    <span>{{ item.bassin!.couleur }}</span>
                                    <span class="at-header-color-preview" [style.background-color]="getColorPreview(item.bassin!.couleur)"></span>
                                </div>
                                <div class="at-header-detail-row at-header-fabrication-time" *ngIf="item.bassin?.surCommande">
                                    <span class="at-header-detail-label">Délai de fabrication:</span>
                                    <span>
                                        <i class="material-icons">schedule</i>
                                        {{ item.bassin?.dureeFabricationDisplay || '2-3 semaines' }}
                                    </span>
                                </div>
                            </div>
                            <div class="at-header-price-summary">
                                <div class="at-header-price-row">
                                    <span>Prix de base:</span>
                                    <span>{{ item.prixOriginal | number:'1.2-2' }} TND</span>
                                </div>
                                <div class="at-header-price-row" *ngIf="item.isCustomized">
                                    <span>Suppléments:</span>
                                    <span>{{ calculateSupplements(item) | number:'1.2-2' }} TND</span>
                                </div>
                                <div class="at-header-price-row at-header-promotion" *ngIf="item.promotionActive">
                                    <span>Réduction:</span>
                                    <span>-{{ calculateReduction(item) | number:'1.2-2' }} TND</span>
                                </div>
                                <div class="at-header-price-row at-header-grand-total">
                                    <span>Total ({{ item.quantity }} bassin(s)):</span>
                                    <span style="color: var(--at-header-primary-dark)">{{ getItemFinalPrice(item) }} TND</span>
                                </div>
                            </div>
                            <div class="at-header-quantity-controls">
                                <button (click)="decrementQuantity(item)" [disabled]="item.quantity <= 1 || isLoading" class="at-header-qty-btn">
                                    <i class="material-icons">remove</i>
                                </button>
                                <span class="at-header-qty-value">{{ item.quantity }}</span>
                                <button (click)="incrementQuantity(item)" [disabled]="!canIncrementQuantity(item) || isLoading" class="at-header-qty-btn">
                                    <i class="material-icons">add</i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="at-header-item-actions">
                        <button (click)="removeFromCart(item)" class="at-header-remove-btn">
                            <i class="material-icons">delete</i> Supprimer
                        </button>
                    </div>
                </div>
            </div>
            <div class="at-header-cart-totals">
                <div class="at-header-total-row">
                    <span>Sous-total:</span>
                    <span>{{ calculateSubTotal() | number:'1.2-2' }} TND</span>
                </div>
                <div class="at-header-total-row">
                    <span>Frais de livraison:</span>
                    <span>{{ calculerFraisLivraison() | number:'1.2-2' }} TND</span>
                </div>
                <div class="at-header-total-row at-header-grand-total">
                    <span>Total:</span>
                    <span>{{ cartTotal }} TND</span>
                </div>
            </div>
            <div class="at-header-cart-footer">
                <div class="at-header-cart-actions">
                    <button class="at-header-continue-shopping" (click)="closeCart()">
                        <i class="material-icons">arrow_back</i>
                        Continuer mes achats
                    </button>
                    <button class="at-header-checkout-btn" routerLink="/cart">
                        <i class="material-icons">shopping_bag</i>
                        Passer commande
                    </button>
                </div>
            </div>
        </div>
        <ng-template #emptyCart>
            <div class="at-header-empty-cart">
                <i class="material-icons">remove_shopping_cart</i>
                <h3>Votre panier est vide</h3>
                <p>Découvrez nos bassins et accessoires de qualité</p>
                <a routerLink="/shop" (click)="closeCart()" class="at-header-btn-shop">
                    Commencer vos achats
                </a>
            </div>
        </ng-template>
    </div>
    <div class="at-header-overlay" [class.at-header-active]="isCartOpen" (click)="closeCart()"></div>

    <!-- Toast container (moved to root level) -->
    <div class="at-toast-container">
        <div class="at-toast" *ngFor="let toast of toastService.toasts$ | async" [ngClass]="toast.classname">
            <i class="material-icons at-toast-icon">{{ toast.icon }}</i>
            <div class="at-toast-content">
                <h4 class="at-toast-header">{{ toast.header }}</h4>
                <span class="at-toast-message">{{ toast.message }}</span>
            </div>
            <button class="at-toast-close" (click)="toast.id && toastService.remove(toast.id)">
                <i class="material-icons">close</i>
            </button>
        </div>
    </div>
        <script>
        let isMenuOpen = false;
        let isCartOpen = false;
        let isDropdownOpen = false;
        let isAuthenticated = false; // Simulate auth status; replace with actual logic

        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            document.getElementById('mobileNav').classList.toggle('translate-x-0', isMenuOpen);
            document.getElementById('mobileNav').classList.toggle('-translate-x-full', !isMenuOpen);
            document.getElementById('overlay').classList.toggle('hidden', !isMenuOpen);
        }

        function toggleCart() {
            isCartOpen = !isCartOpen;
            document.getElementById('cartSidebar').classList.toggle('translate-x-0', isCartOpen);
            document.getElementById('cartSidebar').classList.toggle('translate-x-full', !isCartOpen);
            document.getElementById('overlay').classList.toggle('hidden', !isCartOpen);
            if (isDropdownOpen) toggleDropdown();
        }

        function closeCart() {
            isCartOpen = false;
            document.getElementById('cartSidebar').classList.remove('translate-x-0');
            document.getElementById('cartSidebar').classList.add('translate-x-full');
            document.getElementById('overlay').classList.add('hidden');
        }

        function toggleDropdown() {
            isDropdownOpen = !isDropdownOpen;
            const dropdownMenu = document.getElementById('at-header-dropdown-menu');
            const profileBtn = document.querySelector('.at-header-profile-btn');
            dropdownMenu.classList.toggle('hidden', !isDropdownOpen);
            dropdownMenu.classList.toggle('opacity-100', isDropdownOpen);
            dropdownMenu.classList.toggle('opacity-0', !isDropdownOpen);
            dropdownMenu.classList.toggle('translate-y-0', isDropdownOpen);
            dropdownMenu.classList.toggle('translate-y-2', !isDropdownOpen);
            profileBtn.setAttribute('aria-expanded', isDropdownOpen);
            document.getElementById('overlay').classList.toggle('hidden', !isDropdownOpen);
        }

        function closeDropdown() {
            isDropdownOpen = false;
            document.getElementById('at-header-dropdown-menu').classList.add('hidden');
            document.getElementById('at-header-dropdown-menu').classList.remove('opacity-100');
            document.getElementById('at-header-dropdown-menu').classList.add('opacity-0');
            document.getElementById('at-header-dropdown-menu').classList.remove('translate-y-0');
            document.getElementById('at-header-dropdown-menu').classList.add('translate-y-2');
            document.querySelector('.at-header-profile-btn').setAttribute('aria-expanded', 'false');
            document.getElementById('overlay').classList.add('hidden');
        }

        function closeAll() {
            closeCart();
            closeDropdown();
            if (isMenuOpen) toggleMenu();
        }

        function openNotifications() {
            showToast('Notifications ouvertes', 'info');
        }

        function openChat() {
            showToast('Chat support ouvert', 'info');
        }

        function logout() {
            showToast('Déconnexion effectuée', 'success');
            document.getElementById('profileSection').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
            isAuthenticated = false;
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            const bgClass = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-teal-600',
                warning: 'bg-yellow-500'
            }[type] || 'bg-teal-600';
            toast.className = `at-header-toast flex items-center p-4 mb-2 rounded-lg shadow-lg text-white ${bgClass} opacity-0 transform translate-x-full`;
            toast.innerHTML = `
                <i class="material-icons at-header-toast-icon">info</i>
                <div class="at-header-toast-content">
                    <span class="at-header-toast-message">${message}</span>
                </div>
                <button class="at-header-toast-close" onclick="this.parentElement.classList.add('fade-out'); setTimeout(() => this.parentElement.remove(), 500)">
                    <i class="material-icons">close</i>
                </button>
            `;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('at-header-active'), 10);
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        function checkAuthStatus() {
            // Simulate auth check; replace with actual logic
            document.getElementById('profileSection').classList.toggle('hidden', !isAuthenticated);
            document.getElementById('authButtons').classList.toggle('hidden', isAuthenticated);
        }

        // Sample cart items for demonstration
        const cartItems = [
            {
                id: 1,
                nomBassin: 'Bassin Personnalisé',
                quantity: 1,
                prixOriginal: 150.00,
                isCustomized: true,
                customProperties: {
                    dimensionSelectionnee: '2m x 1m',
                    materiauSelectionne: 'Béton fibré',
                    couleurSelectionnee: 'Bleu clair',
                    accessoires: [
                        { nomAccessoire: 'Pompe', prixAccessoire: 30.00 },
                        { nomAccessoire: 'Filtre', prixAccessoire: 20.00 }
                    ],
                    dureeFabrication: '7 jours'
                },
                imageUrl: 'assets/images/bassin.jpg',
                promotionActive: true,
                tauxReduction: 0.1
            }
        ];

        function renderCartItems() {
            const cartItemsContainer = document.getElementById('cartItems');
            const cartTotals = document.getElementById('cartTotals');
            const cartFooter = document.getElementById('cartFooter');
            const emptyCart = document.getElementById('emptyCart');

            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = '';
                cartTotals.classList.add('hidden');
                cartFooter.classList.add('hidden');
                emptyCart.classList.remove('hidden');
                document.getElementById('cartCount').classList.add('hidden');
                return;
            }

            emptyCart.classList.add('hidden');
            cartTotals.classList.remove('hidden');
            cartFooter.classList.remove('hidden');
            document.getElementById('cartCount').classList.remove('hidden');
            document.getElementById('cartCount').textContent = cartItems.reduce((sum, item) => sum + item.quantity, 0).toString();

            let subtotal = 0;
            cartItemsContainer.innerHTML = cartItems.map(item => {
                const effectivePrice = item.promotionActive
                    ? item.prixOriginal * (1 - item.tauxReduction)
                    : item.prixOriginal;
                const itemTotal = effectivePrice * item.quantity;
                subtotal += itemTotal;

                const accessoriesList = item.customProperties?.accessoires?.map(acc => `
                    <li class="at-header-accessory-item">${acc.nomAccessoire} (+${acc.prixAccessoire.toFixed(2)} TND)</li>
                `).join('') || '';

                return `
                    <div class="at-header-cart-item border rounded-lg p-4 bg-gray-50 hover:scale-[1.02] transition">
                        <div class="at-header-item-header flex justify-between items-start flex-wrap gap-2">
                            <h3 class="text-sm font-semibold">${item.nomBassin}</h3>
                            <div class="at-header-badges flex gap-2">
                                ${item.isCustomized ? '<span class="at-header-badge at-header-badge-custom px-2 py-1 rounded text-xs bg-yellow-500 text-white">Personnalisé</span>' : ''}
                                ${item.promotionActive ? `<span class="at-header-badge at-header-badge-promo px-2 py-1 rounded text-xs bg-teal-500 text-white">-${item.tauxReduction * 100}%</span>` : ''}
                            </div>
                        </div>
                        <div class="at-header-item-content flex gap-4 flex-col sm:flex-row">
                            <div class="at-header-item-image w-full sm:w-24 h-24 rounded overflow-hidden">
                                <img src="${item.imageUrl || 'assets/default-image.webp'}" alt="${item.nomBassin}" class="w-full h-full object-cover">
                            </div>
                            <div class="at-header-item-details flex-1 flex flex-col gap-2">
                                <div class="at-header-detail-row flex gap-2 text-sm">
                                    <span class="at-header-detail-label font-medium">Dimensions:</span>
                                    <span>${item.customProperties?.dimensionSelectionnee || 'Standard'}</span>
                                </div>
                                <div class="at-header-detail-row flex gap-2 text-sm">
                                    <span class="at-header-detail-label font-medium">Matériau:</span>
                                    <span>${item.customProperties?.materiauSelectionne || 'Standard'}</span>
                                </div>
                                <div class="at-header-detail-row flex gap-2 text-sm">
                                    <span class="at-header-detail-label font-medium">Couleur:</span>
                                    <span class="flex items-center gap-1">
                                        ${item.customProperties?.couleurSelectionnee || 'Standard'}
                                        <span class="at-header-color-preview w-3 h-3 rounded-full border" style="background-color: ${item.customProperties?.couleurSelectionnee === 'Bleu clair' ? '#7EC0EE' : '#CCCCCC'}"></span>
                                    </span>
                                </div>
                                <ul class="at-header-accessories-list pl-4 text-sm">${accessoriesList}</ul>
                                <div class="at-header-price-summary border-t pt-2 mt-2">
                                    <div class="at-header-price-row flex justify-between text-sm">
                                        <span>Prix unitaire:</span>
                                        <span>${item.prixOriginal.toFixed(2)} TND</span>
                                    </div>
                                    ${item.promotionActive ? `
                                        <div class="at-header-price-row at-header-promotion flex justify-between text-sm text-green-600">
                                            <span>Réduction:</span>
                                            <span>-${(item.prixOriginal * item.tauxReduction).toFixed(2)} TND</span>
                                        </div>
                                    ` : ''}
                                    <div class="at-header-price-row at-header-grand-total flex justify-between text-sm font-semibold">
                                        <span>Total:</span>
                                        <span>${itemTotal.toFixed(2)} TND</span>
                                    </div>
                                </div>
                                <div class="at-header-quantity-controls flex items-center gap-2">
                                    <button class="at-header-qty-btn bg-white text-gray-800 w-8 h-8 rounded-full hover:bg-teal-50 hover:text-teal-600" onclick="updateQuantity(${item.id}, ${item.quantity - 1})" ${item.quantity <= 1 ? 'disabled' : ''}>
                                        <i class="material-icons text-sm">remove</i>
                                    </button>
                                    <span class="at-header-qty-value text-sm font-medium">${item.quantity}</span>
                                    <button class="at-header-qty-btn bg-white text-gray-800 w-8 h-8 rounded-full hover:bg-teal-50 hover:text-teal-600" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">
                                        <i class="material-icons text-sm">add</i>
                                    </button>
                                </div>
                                <div class="at-header-item-actions text-right">
                                    <button class="at-header-remove-btn text-red-500 text-sm flex items-center gap-1 hover:text-red-700" onclick="removeFromCart(${item.id})">
                                        <i class="material-icons text-sm">delete</i> Supprimer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)} TND`;
            document.getElementById('shipping-cost').textContent = cartItems.length > 0 ? '20.00 TND' : '0.00 TND';
            document.getElementById('total').textContent = `${(subtotal + (cartItems.length > 0 ? 20 : 0)).toFixed(2)} TND`;
        }

        function updateQuantity(itemId, newQuantity) {
            const item = cartItems.find(i => i.id === itemId);
            if (!item || newQuantity < 1) return;
            item.quantity = newQuantity;
            if (item.quantity === 0) {
                removeFromCart(itemId);
                return;
            }
            renderCartItems();
            showToast('Quantité mise à jour', 'success');
        }

        function removeFromCart(itemId) {
            const index = cartItems.findIndex(i => i.id === itemId);
            if (index !== -1) {
                cartItems.splice(index, 1);
                renderCartItems();
                showToast('Article supprimé', 'success');
            }
        }

        window.onload = () => {
            checkAuthStatus();
            renderCartItems();
        };
    </script>
</body>
</html>